# NOW IS USING catkin build

# ######################################
# In Simulation
# ######################################
# Necessary packages for the sensors in Gazebo: 
# ros-kinetic-hector-gazebo-pluginss and ros-kinetic-geographic-msgs
roslaunch am_gazebo am_gazebo_hrp.launch gui:=true
rosrun am_driver hrp_teleop.py

# tf publish
rosrun tf2_ros static_transform_publisher 0 0 0 0 0 0 map odom 
rqt &


# ######################################
# In practice
# ######################################
# USB cable control: /dev/ttyACM0
# UART control: /dev/ttyUSB0
roslaunch am_driver_safe automower_hrp.launch
rosrun am_driver hrp_teleop.py

# Trun off the sensor or set the control mode.
rostopic pub -1 cmd_mode std_msgs/UInt16 "data: 275" 


# ######################################
# Localization node
# ######################################
roslaunch robot_localization ekf_template.launch

# IMU&GNSS launch 
roslaunch am_sensors sensors.launch

# Calibrate the IMU. Zero the angular velocity. 
# Done automically when started.
rosservice call /imu/calibrate

# Approx. the true latitude & longitude at my desk at RISE.
# 59.40455 17.94965

# Tracking by markers.
rosrun am_sensors tracking_marker_pub

# Launch Realsense D435, now also available in am_sensors
roslaunch realsense2_camera rs_camera.launch filters:=pointcloud enable_infra1:=false enable_infra2:=false
roslaunch realsense2_camera rs_camera.launch align_depth:=true enable_infra1:=false enable_infra2:=false
roslaunch am_sensors rs_camrra.launch

# Change cameara control values.
rosrun rqt_reconfigure rqt_reconfigure

# Launch RTAB-Map for D435. 
roslaunch rtabmap_ros rtabmap.launch \
    rtabmap_args:="--delete_db_on_start" \
    depth_topic:=/camera/aligned_depth_to_color/image_raw \
    rgb_topic:=/camera/color/image_raw \
    camera_info_topic:=/camera/color/camera_info \
    approx_sync:=false


# View the map.
rtabmap-databaseViewer ~/.ros/rtabmap.db

# Making ros bag
rosbag record -o indoor_localization_test_20200712.bag cmd_mode cmd_vel imu_left/imu/data imu_left/imu/data/processed imu_left/imu/data_raw imu_left/imu/mag imu_left/imu_manager/bond imu_right/ImuFilterNodelet/parameter_descriptions imu_right/imu/data /imu_right/imu/data/processed imu_right/imu/data_raw imu_right/imu/mag initialpose joint_states odom pose tf tf_static wheel_current wheel_encoder


# SVO 
roslaunch svo_ros test_rig3.launch
rosrun rviz rviz -d /home/tianze/husqvarna_automower/src/rgb_svo/svo_ros/rviz_config.rviz
rosbag play airground_rig_s3_2013-03-18_21-38-48.bag
